{{ define "main" }}
  <header class="section-head section-head--center">
    <div class="section-title-row">
      <h1 class="section-title">{{ .Title }}</h1>
    </div>
    {{ with .Content }}
      <div class="section-intro">
        {{ . }}
      </div>
    {{ end }}
  </header>

  {{- $showDrafts := or hugo.IsDevelopment .Site.BuildDrafts -}}
  {{ if not $showDrafts }}
    {{ with .Data.Terms.Alphabetical }}
      <ul class="term-list">
        {{ range . }}
          <li>
            <a href="{{ .Page.RelPermalink }}">{{ .Page.Title }}</a>
            <span>{{ .Count }} Posts</span>
          </li>
        {{ end }}
      </ul>
    {{ else }}
      <p class="post-empty">No tags found yet.</p>
    {{ end }}
  {{ else }}
    {{- $scratch := newScratch -}}
    {{- $scratch.Set "tagNames" (dict) -}}
    {{- range .Site.RegularPages -}}
      {{- if or (not .Draft) $showDrafts -}}
        {{- $page := . -}}
        {{- with $page.Params.tags -}}
          {{- range . -}}
            {{- $tag := . -}}
            {{- $slug := urlize $tag -}}
            {{- $countKey := printf "count-%s" $slug -}}
            {{- $count := $scratch.Get $countKey | default 0 -}}
            {{- $scratch.Set $countKey (add $count 1) -}}
            {{- $scratch.SetInMap "tagNames" $slug $tag -}}
          {{- end -}}
        {{- end -}}
      {{- end -}}
    {{- end -}}
    {{- $tagNames := $scratch.Get "tagNames" -}}
    {{- $keySlice := slice -}}
    {{- range $slug, $name := $tagNames -}}
      {{- $keySlice = $keySlice | append $slug -}}
    {{- end -}}
    {{- $keys := sort $keySlice -}}
    {{ if gt (len $keys) 0 }}
      <ul class="term-list">
        {{ range $keys }}
          {{- $slug := . -}}
          {{- $tagName := index $tagNames $slug -}}
          {{- $countKey := printf "count-%s" $slug -}}
          {{- $count := $scratch.Get $countKey | default 0 -}}
          {{- if gt $count 0 }}
            <li>
              <a href="{{ (printf "/tags/%s" $slug) | relLangURL }}">{{ $tagName }}</a>
              <span>{{ $count }} Posts</span>
            </li>
          {{- end -}}
        {{ end }}
      </ul>
    {{ else }}
      <p class="post-empty">No tags found yet.</p>
    {{ end }}
  {{ end }}
{{ end }}
