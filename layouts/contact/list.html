{{ define "main" }}
  {{ $siteContact := .Site.Params.contact }}
  {{ $hero := .Params.hero }}
  {{ if not $hero }}
    {{ with $siteContact }}
      {{ with .hero }}{{ $hero = . }}{{ end }}
    {{ end }}
  {{ end }}
  {{ $heroTitle := .Title }}
  {{ with $hero }}
    {{ with .title }}{{ $heroTitle = . }}{{ end }}
  {{ end }}

  <section class="contact-hero">
    <div class="contact-hero__body">
      <h1>{{ $heroTitle }}</h1>
      {{ with $hero }}
        {{ with .body }}
          {{ . | markdownify }}
        {{ end }}
      {{ end }}
    </div>

    {{ with $hero }}
      {{ with .cta }}
        {{ $url := .url | default (print "mailto:" $.Site.Params.email) }}
        {{ $safeURL := $url | safeURL }}
        {{ $isExternal := or (strings.HasPrefix $url "http") (strings.HasPrefix $url "//") }}
        <a class="contact-hero__cta" href="{{ $safeURL }}" {{ if $isExternal }}target="_blank" rel="noopener noreferrer"{{ end }}>
          {{ .label | default "Send a note" }}
        </a>
      {{ end }}

      {{ with .note }}
        <p class="contact-hero__note">{{ . }}</p>
      {{ end }}
    {{ end }}
  </section>

  {{ $contacts := .Params.contacts }}
  {{ if not $contacts }}
    {{ with $siteContact }}
      {{ with .contacts }}{{ $contacts = . }}{{ end }}
    {{ end }}
  {{ end }}

  {{ with $contacts }}
    <section class="contact-list-wrapper">
      <h2>{{ .heading | default "Ways to reach me" }}</h2>
      {{ with .intro }}
        <p class="contact-list__intro">{{ . }}</p>
      {{ end }}

      {{ with .items }}
        <ul class="contact-list">
          {{ range . }}
            <li>
              {{ with .icon }}
                <div class="contact-list__icon" aria-hidden="true">
                  {{ partial "svg.html" . }}
                </div>
              {{ end }}
              <div class="contact-list__body">
                {{ with .label }}
                  <span class="contact-list__label">{{ . }}</span>
                {{ end }}
                {{ $value := .value | default .url }}
                {{ if .url }}
                  {{ $url := .url }}
                  {{ $safeURL := $url | safeURL }}
                  {{ $isExternal := or (strings.HasPrefix $url "http") (strings.HasPrefix $url "//") }}
                  <a href="{{ $safeURL }}" {{ if $isExternal }}target="_blank" rel="noopener noreferrer"{{ end }}>{{ $value }}</a>
                {{ else }}
                  <span>{{ $value }}</span>
                {{ end }}
              </div>
            </li>
          {{ end }}
        </ul>
      {{ end }}
    </section>
  {{ end }}

  {{ with .Content }}
    <div class="contact-extra">{{ . }}</div>
  {{ end }}
{{ end }}
