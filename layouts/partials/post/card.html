{{- $page := .page -}}
{{- $image := or $page.Params.image (or $page.Params.cover $page.Params.thumbnail) -}}
{{- $summary := default $page.Params.summary $page.Summary -}}
{{- $cleanSummary := replaceRE "\\s+" " " ($summary | plainify) -}}
{{- $excerpt := cond (gt (len $cleanSummary) 0) ($cleanSummary | truncate 160) "" -}}
{{- $alt := printf "%s cover image" $page.Title -}}

<article class="post-card">
  <a class="post-card__link" href="{{ $page.RelPermalink }}" aria-label="{{ $page.Title }}">
    <div class="post-card__media">
      {{ with $image }}
        <img src="{{ . }}" loading="lazy" decoding="async" alt="{{ $alt }}">
      {{ else }}
        <span class="post-card__placeholder" aria-hidden="true">{{ upper (substr $page.Title 0 1) }}</span>
      {{ end }}
    </div>
    <div class="post-card__body">
      <div class="post-card__meta">
        <time datetime="{{ $page.Date.Format "2006-01-02" }}">{{ $page.Date.Format "Jan 2, 2006" }}</time>
      </div>
      <h2 class="post-card__title">{{ $page.LinkTitle }}</h2>
      {{ if $excerpt }}
        <p class="post-card__excerpt">{{ $excerpt }}</p>
      {{ end }}
    </div>
  </a>
</article>
